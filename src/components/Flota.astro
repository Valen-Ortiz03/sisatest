---
// Datos de vehículos
const vehicles = [
  {
    image: "/flota-1.webp",
    name: "Camión chico",
    capacity: "Ideal para departamentos de 1–2 ambientes",
    features: [
      "Acceso a calles angostas",
      "Carga rápida",
      "Perfecto para mudanzas en CABA",
    ],
    badge: "Ideal en CABA",
  },
  {
    image: "/flota-2.webp",
    name: "Camión mediano",
    capacity: "Recomendado para 3–4 ambientes",
    features: [
      "Mayor volumen de carga",
      "Mudanzas familiares",
      "Viajes dentro de AMBA",
    ],
    badge: "Más elegido",
  },
  {
    image: "/flota-3.webp",
    name: "Camión grande",
    capacity: "Perfecto para casas completas",
    features: [
      "Gran capacidad",
      "Viajes largos",
      "Mudanzas integrales",
    ],
    badge: "Máxima capacidad",
  },
];
---

<section
  class="py-24"
  data-reveal
  data-reveal-delay="0"
  style="--reveal-margin:-200px"
>
  <div class="max-w-6xl mx-auto px-6">

    <!-- Título -->
    <div class="text-center">
      <h2 class="text-4xl md:text-5xl font-bold text-red-600">Flota</h2>
      <p class="mt-4 text-gray-600 text-lg">
        Contamos con vehículos propios para todo tipo de mudanza.
      </p>
    </div>

    <!-- Slider -->
    <div class="relative mt-16">

      <!-- CONTENEDOR -->
      <div
        id="flota-container"
        class="relative overflow-hidden rounded-[32px]
               bg-white/80
               border border-white/60
               shadow-[0_30px_60px_-20px_rgba(0,0,0,0.15)]"
      >
        <div
          id="flota-slider"
          class="flex transition-transform duration-700 ease-[cubic-bezier(0.16,1,0.3,1)] will-change-transform"
        >
          {vehicles.map((v, i) => (
            <div class="min-w-full px-6 py-10 grid md:grid-cols-2 gap-10 items-center">

              <!-- Imagen -->
              <div class="flex justify-center">
                <img
                  src={v.image}
                  alt={v.name}
                  class="w-full max-w-md object-contain drop-shadow-[0_20px_40px_rgba(0,0,0,0.25)]"
                  loading={i === 0 ? "eager" : "lazy"}
                  decoding="async"
                />
              </div>

              <!-- Contenido -->
              <div>
                <h3 class="text-2xl md:text-3xl font-semibold text-gray-900">
                  {v.name}
                </h3>

                <p class="mt-3 text-gray-600 font-medium">
                  {v.capacity}
                </p>

                <ul class="mt-4 space-y-2 text-gray-700">
                  {v.features.map((f) => (
                    <li>• {f}</li>
                  ))}
                </ul>

                <span
                  class="inline-block mt-6 text-sm font-semibold
                         text-red-600 bg-red-50
                         border border-red-200
                         px-4 py-1 rounded-full"
                >
                  {v.badge}
                </span>
              </div>

            </div>
          ))}
        </div>
      </div>

      <!-- Flechas -->
      <button
        id="flota-prev"
        class="absolute -left-6 top-1/2 -translate-y-1/2
               w-12 h-12 rounded-full
               bg-white/90
               border border-white/60
               shadow-lg
               flex items-center justify-center
               transition duration-300
               hover:scale-110"
      >
        ‹
      </button>

      <button
        id="flota-next"
        class="absolute -right-6 top-1/2 -translate-y-1/2
               w-12 h-12 rounded-full
               bg-white/90
               border border-white/60
               shadow-lg
               flex items-center justify-center
               transition duration-300
               hover:scale-110"
      >
        ›
      </button>

    </div>
  </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const slider = document.getElementById("flota-slider");
  const container = document.getElementById("flota-container");
  const next = document.getElementById("flota-next");
  const prev = document.getElementById("flota-prev");

  if (!slider || !container) return;

  let index = 0;
  const total = slider.children.length;
  let playing = false;
  let lastTime = 0;

  const update = () => {
    slider.style.transform = `translate3d(-${index * 100}%,0,0)`;
  };

  /* autoplay con RAF (suave real) */
  const loop = (time: number) => {
    if (!playing) return;

    if (time - lastTime > 5000) {
      index = (index + 1) % total;
      update();
      lastTime = time;
    }

    requestAnimationFrame(loop);
  };

  const start = () => {
    if (playing) return;
    playing = true;
    lastTime = performance.now();
    requestAnimationFrame(loop);
  };

  const stop = () => {
    playing = false;
  };

  next?.addEventListener("click", () => {
    index = (index + 1) % total;
    update();
  });

  prev?.addEventListener("click", () => {
    index = (index - 1 + total) % total;
    update();
  });

  /* swipe mobile */
  let startX = 0;

  container.addEventListener("touchstart", (e) => {
    startX = e.touches[0].clientX;
  });

  container.addEventListener("touchend", (e) => {
    const diff = startX - e.changedTouches[0].clientX;

    if (Math.abs(diff) > 50) {
      index = diff > 0
        ? (index + 1) % total
        : (index - 1 + total) % total;

      update();
    }
  });

  /* autoplay solo visible */
  const observer = new IntersectionObserver(
    ([entry]) => {
      entry.isIntersecting ? start() : stop();
    },
    { threshold: 0.35 }
  );

  observer.observe(container);
});
</script>